# KIS Demoã‚·ã‚¹ãƒ†ãƒ  - ã‚¯ãƒ©ã‚¹ãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©

## ğŸ“‹ æ¦‚è¦

KIS Demoã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ä¸»è¦ãªã‚¯ãƒ©ã‚¹ã€ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚’è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã¯TypeScriptã«ã‚ˆã‚‹å‹å®‰å…¨ãªè¨­è¨ˆã¨SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ãŸéšå±¤åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TypeScript Interface Layer      â”‚ Frontend/Backend Types
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Model Class Layer               â”‚ BaseModel + Specific Models
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Database Schema Layer           â”‚ SQLite Tables
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

### 1. users ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| username | VARCHAR(50) | UNIQUE NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| email | VARCHAR(100) | UNIQUE NOT NULL | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| password_hash | VARCHAR(255) | NOT NULL | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ï¼ˆbcryptï¼‰ |
| role | VARCHAR(20) | DEFAULT 'user' | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ï¼ˆadmin/userï¼‰ |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: ãªã—ï¼ˆä¸»ã‚­ãƒ¼ã®ã¿ï¼‰

### 2. customers ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆé¡§å®¢ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | é¡§å®¢ID |
| customer_code | VARCHAR(20) | UNIQUE NOT NULL | é¡§å®¢ã‚³ãƒ¼ãƒ‰ |
| name | VARCHAR(100) | NOT NULL | é¡§å®¢å |
| email | VARCHAR(100) | NULL | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| phone | VARCHAR(20) | NULL | é›»è©±ç•ªå· |
| address | TEXT | NULL | ä½æ‰€ |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |
| created_by | INTEGER | FOREIGN KEY â†’ users(id) | ä½œæˆè€…ID |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_customers_code` (customer_code)

### 3. products ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå•†å“ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | å•†å“ID |
| product_code | VARCHAR(20) | UNIQUE NOT NULL | å•†å“ã‚³ãƒ¼ãƒ‰ |
| name | VARCHAR(100) | NOT NULL | å•†å“å |
| description | TEXT | NULL | å•†å“èª¬æ˜ |
| price | DECIMAL(10,2) | NOT NULL | å˜ä¾¡ |
| stock_quantity | INTEGER | DEFAULT 0 | åœ¨åº«æ•°é‡ |
| category | VARCHAR(50) | NULL | ã‚«ãƒ†ã‚´ãƒª |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |
| created_by | INTEGER | FOREIGN KEY â†’ users(id) | ä½œæˆè€…ID |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_products_code` (product_code)

### 4. orders ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ³¨æ–‡ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | æ³¨æ–‡ID |
| order_number | VARCHAR(20) | UNIQUE NOT NULL | æ³¨æ–‡ç•ªå· |
| customer_id | INTEGER | NOT NULL, FOREIGN KEY â†’ customers(id) | é¡§å®¢ID |
| total_amount | DECIMAL(10,2) | NOT NULL | æ³¨æ–‡ç·é¡ |
| status | VARCHAR(20) | DEFAULT 'pending' | æ³¨æ–‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| order_date | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ³¨æ–‡æ—¥æ™‚ |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |
| created_by | INTEGER | FOREIGN KEY â†’ users(id) | ä½œæˆè€…ID |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: 
- `idx_orders_number` (order_number)
- `idx_orders_customer` (customer_id)

### 5. order_items ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ³¨æ–‡æ˜ç´°ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | æ³¨æ–‡æ˜ç´°ID |
| order_id | INTEGER | NOT NULL, FOREIGN KEY â†’ orders(id) ON DELETE CASCADE | æ³¨æ–‡ID |
| product_id | INTEGER | NOT NULL, FOREIGN KEY â†’ products(id) | å•†å“ID |
| quantity | INTEGER | NOT NULL | æ•°é‡ |
| unit_price | DECIMAL(10,2) | NOT NULL | å˜ä¾¡ |
| subtotal | DECIMAL(10,2) | NOT NULL | å°è¨ˆ |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_order_items_order` (order_id)

### 6. permission_matrix ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ¨©é™ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | æ¨©é™ID |
| user_id | INTEGER | NOT NULL, FOREIGN KEY â†’ users(id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| entity_type | VARCHAR(20) | NOT NULL | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ— |
| operation_type | VARCHAR(10) | NOT NULL | æ“ä½œã‚¿ã‚¤ãƒ— |
| screen_name | VARCHAR(50) | NOT NULL | ç”»é¢å |
| is_allowed | BOOLEAN | DEFAULT FALSE | è¨±å¯ãƒ•ãƒ©ã‚° |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: 
- `idx_permission_matrix_user` (user_id)
- `idx_permission_matrix_entity` (entity_type, operation_type)

**UNIQUEåˆ¶ç´„**: (user_id, entity_type, operation_type, screen_name)

## ğŸ”— ERå›³ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢ä¿‚å›³ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚     â”‚ customers   â”‚     â”‚  products   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â”€â”€â”€â”€â”â”‚ id (PK)     â”‚     â”‚ id (PK)     â”‚
â”‚ username    â”‚    â”‚â”‚customer_codeâ”‚     â”‚product_code â”‚
â”‚ email       â”‚    â”‚â”‚ name        â”‚     â”‚ name        â”‚
â”‚ password_h. â”‚    â”‚â”‚ email       â”‚     â”‚ description â”‚
â”‚ role        â”‚    â”‚â”‚ phone       â”‚     â”‚ price       â”‚
â”‚ created_at  â”‚    â”‚â”‚ address     â”‚     â”‚ stock_qty   â”‚
â”‚ updated_at  â”‚    â”‚â”‚ created_by  â”‚â”€â”€â”€â”€â”€â”¤ category    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ created_by  â”‚â”€â”€â”€â”€â”€â”
       â”‚           â”‚                    â”‚ created_at  â”‚     â”‚
       â”‚           â”‚                    â”‚ updated_at  â”‚     â”‚
       â”‚           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
       â”‚           â”‚                                        â”‚
       â”‚           â–¼                                        â”‚
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
       â”‚    â”‚   orders    â”‚                                 â”‚
       â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
       â”‚    â”‚ id (PK)     â”‚                                 â”‚
       â”‚    â”‚order_number â”‚                                 â”‚
       â”‚    â”‚customer_id  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚    â”‚total_amount â”‚                                 â”‚
       â”‚    â”‚ status      â”‚                                 â”‚
       â”‚    â”‚ order_date  â”‚                                 â”‚
       â”‚    â”‚ created_by  â”‚â”€â”€â”€â”€â”€â”                           â”‚
       â”‚    â”‚ created_at  â”‚     â”‚                           â”‚
       â”‚    â”‚ updated_at  â”‚     â”‚                           â”‚
       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                           â”‚
       â”‚           â”‚             â”‚                           â”‚
       â”‚           â–¼             â”‚                           â”‚
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                           â”‚
       â”‚    â”‚ order_items â”‚     â”‚                           â”‚
       â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚                           â”‚
       â”‚    â”‚ id (PK)     â”‚     â”‚                           â”‚
       â”‚    â”‚ order_id(FK)â”‚â”€â”€â”€â”€â”€â”˜                           â”‚
       â”‚    â”‚ product_id  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚ quantity    â”‚
       â”‚    â”‚ unit_price  â”‚
       â”‚    â”‚ subtotal    â”‚
       â”‚    â”‚ created_at  â”‚
       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    
       â–¼                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      permission_matrix          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                         â”‚
â”‚ user_id (FK)                    â”‚
â”‚ entity_type                     â”‚
â”‚ operation_type                  â”‚
â”‚ screen_name                     â”‚
â”‚ is_allowed                      â”‚
â”‚ created_at                      â”‚
â”‚ updated_at                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ·ï¸ TypeScriptå‹å®šç¾©

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®šç¾©ï¼ˆfrontend/src/types/index.tsï¼‰

#### åŸºæœ¬ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‹

```typescript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼å‹
export interface User {
  id: number
  username: string
  email: string
  role: string
  created_at: string
  updated_at: string
}

// é¡§å®¢å‹
export interface Customer {
  id: number
  customer_code: string
  name: string
  email?: string
  phone?: string
  address?: string
  created_at: string
  updated_at: string
  created_by: number
}

// å•†å“å‹
export interface Product {
  id: number
  product_code: string
  name: string
  description?: string
  price: number
  stock_quantity: number
  category?: string
  created_at: string
  updated_at: string
  created_by: number
}

// æ³¨æ–‡å‹
export interface Order {
  id: number
  order_number: string
  customer_id: number
  total_amount: number
  status: 'pending' | 'confirmed' | 'shipped' | 'delivered' | 'cancelled'
  order_date: string
  created_at: string
  updated_at: string
  created_by: number
  customer?: Partial<Customer>
  items?: OrderItem[]
}

// æ³¨æ–‡æ˜ç´°å‹
export interface OrderItem {
  id: number
  order_id: number
  product_id: number
  quantity: number
  unit_price: number
  subtotal: number
  created_at: string
  product?: Partial<Product>
}

// æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å‹
export interface PermissionMatrix {
  id: number
  user_id: number
  entity_type: 'customers' | 'products' | 'orders'
  operation_type: 'create' | 'read' | 'update' | 'delete'
  screen_name: string
  is_allowed: boolean
  created_at: string
  updated_at: string
}
```

#### APIé–¢é€£å‹

```typescript
// API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface ApiResponse<T = any> {
  success: boolean
  data?: T
  message?: string
  error?: string
}

// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface PaginatedResponse<T> {
  data: T[]
  total: number
  page: number
  limit: number
  totalPages: number
}

// èªè¨¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface AuthResponse {
  user: User
  token: string
}

// ãƒ•ã‚©ãƒ¼ãƒ å‹
export interface LoginForm {
  username: string
  password: string
}

export interface CustomerForm {
  customer_code: string
  name: string
  email?: string
  phone?: string
  address?: string
}

export interface ProductForm {
  product_code: string
  name: string
  description?: string
  price: number
  stock_quantity?: number
  category?: string
}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‹å®šç¾©ï¼ˆbackend/src/types/index.tsï¼‰

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹

```typescript
// é¡§å®¢ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
export interface CreateCustomerRequest {
  customer_code: string
  name: string
  email?: string
  phone?: string
  address?: string
}

// å•†å“ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
export interface CreateProductRequest {
  product_code: string
  name: string
  description?: string
  price: number
  stock_quantity?: number
  category?: string
}

// æ³¨æ–‡ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
export interface CreateOrderRequest {
  customer_id: number
  items: {
    product_id: number
    quantity: number
    unit_price: number
  }[]
}

// èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
export interface AuthRequest {
  username: string
  password: string
}
```

## ğŸ¯ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

### 1. BaseModelï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰

```typescript
export abstract class BaseModel {
  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå–å¾—
  protected static async getDb(): Promise<Database>
  
  // åŸºæœ¬ã‚¯ã‚¨ãƒªå®Ÿè¡Œãƒ¡ã‚½ãƒƒãƒ‰
  protected static async executeQuery<T>(sql: string, params?: any[]): Promise<T[]>
  protected static async executeQuerySingle<T>(sql: string, params?: any[]): Promise<T | undefined>
  protected static async executeInsert(sql: string, params?: any[]): Promise<number>
  protected static async executeUpdate(sql: string, params?: any[]): Promise<number>
  
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
  protected static buildWhereClause(filters: Record<string, any>): {
    whereClause: string
    params: any[]
  }
  protected static buildPaginationClause(page?: number, limit?: number): {
    paginationClause: string
    offset: number
    actualLimit: number
  }
}
```

**ç‰¹å¾´**:
- å…¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®åŸºåº•ã‚¯ãƒ©ã‚¹
- å…±é€šã®CRUDæ“ä½œã‚’æŠ½è±¡åŒ–
- SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®çµ±ä¸€åŒ–
- å‹å®‰å…¨ãªã‚¯ã‚¨ãƒªå®Ÿè¡Œ

### 2. UserModelï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ï¼‰

```typescript
export class UserModel extends BaseModel {
  // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
  static async findAll(): Promise<User[]>
  static async findById(id: number): Promise<User | undefined>
  static async findByUsername(username: string): Promise<User | undefined>
  static async findByEmail(email: string): Promise<User | undefined>
  static async create(username: string, email: string, password: string, role?: string): Promise<number>
  static async authenticate(username: string, password: string): Promise<User | null>
  static async updatePassword(id: number, newPassword: string): Promise<boolean>
  static async updateRole(id: number, role: string): Promise<boolean>
  static async delete(id: number): Promise<boolean>
  static async isUsernameExists(username: string, excludeId?: number): Promise<boolean>
  static async isEmailExists(email: string, excludeId?: number): Promise<boolean>
}
```

**ç‰¹å¾´**:
- bcryptã«ã‚ˆã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
- èªè¨¼æ©Ÿèƒ½ï¼ˆauthenticateï¼‰
- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ä¿è­·
- é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

### 3. CustomerModelï¼ˆé¡§å®¢ãƒ¢ãƒ‡ãƒ«ï¼‰

```typescript
export class CustomerModel extends BaseModel {
  // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
  static async findAll(filters: {
    name?: string, email?: string, customer_code?: string, page?: number, limit?: number
  }): Promise<{ customers: Customer[]; total: number }>
  static async findById(id: number): Promise<Customer | undefined>
  static async findByCode(customer_code: string): Promise<Customer | undefined>
  static async create(data: CreateCustomerRequest, created_by: number): Promise<number>
  static async update(id: number, data: UpdateCustomerRequest): Promise<boolean>
  static async delete(id: number): Promise<boolean>
  static async isCodeExists(customer_code: string, excludeId?: number): Promise<boolean>
}
```

**ç‰¹å¾´**:
- éƒ¨åˆ†ä¸€è‡´æ¤œç´¢æ©Ÿèƒ½ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ï¼‰
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- é–¢é€£æ³¨æ–‡ãƒã‚§ãƒƒã‚¯ï¼ˆå‰Šé™¤æ™‚ï¼‰
- é¡§å®¢ã‚³ãƒ¼ãƒ‰é‡è¤‡ãƒã‚§ãƒƒã‚¯

### 4. ProductModelï¼ˆå•†å“ãƒ¢ãƒ‡ãƒ«ï¼‰

```typescript
export class ProductModel extends BaseModel {
  // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
  static async findAll(filters: {
    name?: string, category?: string, product_code?: string, page?: number, limit?: number
  }): Promise<{ products: Product[]; total: number }>
  static async findById(id: number): Promise<Product | undefined>
  static async findByCode(product_code: string): Promise<Product | undefined>
  static async create(data: CreateProductRequest, created_by: number): Promise<number>
  static async update(id: number, data: UpdateProductRequest): Promise<boolean>
  static async delete(id: number): Promise<boolean>
  static async updateStock(id: number, quantity: number): Promise<boolean>
  static async getCategories(): Promise<string[]>
  static async isCodeExists(product_code: string, excludeId?: number): Promise<boolean>
}
```

**ç‰¹å¾´**:
- åœ¨åº«ç®¡ç†æ©Ÿèƒ½ï¼ˆupdateStockï¼‰
- ã‚«ãƒ†ã‚´ãƒªä¸€è¦§å–å¾—
- é–¢é€£æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯ï¼ˆå‰Šé™¤æ™‚ï¼‰
- å•†å“ã‚³ãƒ¼ãƒ‰é‡è¤‡ãƒã‚§ãƒƒã‚¯

### 5. OrderModelï¼ˆæ³¨æ–‡ãƒ¢ãƒ‡ãƒ«ï¼‰

```typescript
export class OrderModel extends BaseModel {
  // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
  static async findAll(filters: {
    customer_id?: number, status?: string, order_number?: string, page?: number, limit?: number
  }): Promise<{ orders: Order[]; total: number }>
  static async findById(id: number): Promise<Order | undefined>
  static async findByOrderNumber(order_number: string): Promise<Order | undefined>
  static async create(data: CreateOrderRequest, created_by: number): Promise<number>
  static async update(id: number, data: UpdateOrderRequest): Promise<boolean>
  static async delete(id: number): Promise<boolean>
  static async updateStatus(id: number, status: Order['status']): Promise<boolean>
  private static async generateOrderNumber(): Promise<string>
  private static async getOrderItems(orderId: number): Promise<OrderItem[]>
  static async isOrderNumberExists(order_number: string, excludeId?: number): Promise<boolean>
}
```

**ç‰¹å¾´**:
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰
- æ³¨æ–‡ç•ªå·è‡ªå‹•ç”Ÿæˆï¼ˆæ—¥ä»˜ãƒ™ãƒ¼ã‚¹ï¼‰
- æ³¨æ–‡æ˜ç´°ã®é–¢é€£ç®¡ç†
- é¡§å®¢ãƒ»å•†å“æƒ…å ±ã®çµåˆå–å¾—

### 6. PermissionModelï¼ˆæ¨©é™ãƒ¢ãƒ‡ãƒ«ï¼‰

```typescript
export class PermissionModel extends BaseModel {
  // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
  static async findByUserId(userId: number): Promise<PermissionMatrix[]>
  static async checkPermission(userId: number, entityType: string, operationType: string, screenName: string): Promise<boolean>
  static async setPermission(userId: number, entityType: string, operationType: string, screenName: string, isAllowed: boolean): Promise<boolean>
  static async setUserPermissions(userId: number, permissions: Array<{...}>): Promise<boolean>
  static async getPermissionMatrix(): Promise<{
    screens: Array<{...}>
    users: User[]
    permissions: Record<string, Record<string, boolean>>
  }>
  static async initializeDefaultPermissions(userId: number, role?: string): Promise<void>
  private static getDefaultPermissionsByRole(role: string)
}
```

**ç‰¹å¾´**:
- æ¨©é™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
- æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ç”Ÿæˆ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™è¨­å®š
- ãƒ­ãƒ¼ãƒ«åˆ¥æ¨©é™ç®¡ç†

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ»åˆ¶ç´„

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«åˆ¶ç´„
- **ä¸»ã‚­ãƒ¼åˆ¶ç´„**: è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
- **å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„**: å‚ç…§æ•´åˆæ€§ä¿è¨¼
- **UNIQUEåˆ¶ç´„**: é‡è¤‡é˜²æ­¢ï¼ˆã‚³ãƒ¼ãƒ‰ã€ãƒ¡ãƒ¼ãƒ«ç­‰ï¼‰
- **NOT NULLåˆ¶ç´„**: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **DEFAULTå€¤**: åˆæœŸå€¤è¨­å®š

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«æ¤œè¨¼
- **å…¥åŠ›å€¤æ¤œè¨¼**: Zodã‚¹ã‚­ãƒ¼ãƒ
- **å‹æ¤œè¨¼**: TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ 
- **æ¥­å‹™ãƒ«ãƒ¼ãƒ«æ¤œè¨¼**: ãƒ¢ãƒ‡ãƒ«å†…ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- **æ¨©é™æ¤œè¨¼**: æ¨©é™ãƒ¢ãƒ‡ãƒ«

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–**: bcryptï¼ˆã‚½ãƒ«ãƒˆãƒ©ã‚¦ãƒ³ãƒ‰10ï¼‰
- **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª
- **XSSå¯¾ç­–**: å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³**: JWTï¼ˆHS256ï¼‰

---

*æœ€çµ‚æ›´æ–°: 2024å¹´1æœˆ15æ—¥*  
*ä½œæˆè€…: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒŠãƒªã‚¹ãƒˆ*
