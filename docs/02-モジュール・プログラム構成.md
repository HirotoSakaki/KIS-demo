# KIS Demoシステム - モジュール／プログラム構成

## 📋 概要

KIS Demoシステムは、フロントエンド（React）とバックエンド（Express）の2つの主要なサブシステムで構成されています。各サブシステムは明確に分離された階層構造を持ち、モジュール間の依存関係を最小限に抑えたクリーンアーキテクチャを採用しています。

## 🏗️ システム全体構成

```
KIS-demo/
├── 📱 frontend/          # フロントエンドモジュール
├── 🔧 backend/           # バックエンドモジュール  
├── 📚 docs/              # ドキュメントモジュール
├── 🐳 docker/            # コンテナ設定モジュール
└── 📋 scripts/           # 運用スクリプトモジュール
```

## 🎨 フロントエンドモジュール構成

### ディレクトリ構造

```
frontend/
├── src/
│   ├── 📄 App.tsx                 # アプリケーションルート
│   ├── 🎯 main.tsx                # エントリーポイント
│   ├── 🧩 components/             # 共通コンポーネント層
│   │   ├── Layout.tsx             # レイアウトコンポーネント
│   │   └── ProtectedRoute.tsx     # 認証保護ルート
│   ├── 📱 pages/                  # ページコンポーネント層
│   │   ├── DashboardPage.tsx      # ダッシュボード
│   │   ├── CustomersPage.tsx      # 顧客管理
│   │   ├── ProductsPage.tsx       # 商品管理
│   │   ├── OrdersPage.tsx         # 注文管理
│   │   ├── LoginPage.tsx          # ログイン
│   │   ├── PermissionMatrixPage.tsx # 権限マトリックス
│   │   ├── PartnersPage.tsx       # パートナー管理
│   │   ├── SuppliersPage.tsx      # サプライヤー管理
│   │   ├── InvoicesPage.tsx       # 請求書管理
│   │   └── InventoryPage.tsx      # 在庫管理
│   ├── 🪝 hooks/                  # カスタムフック層
│   │   └── useAuth.tsx            # 認証フック
│   ├── 🔧 utils/                  # ユーティリティ層
│   │   ├── api.ts                 # API通信
│   │   └── permissions.ts         # 権限管理
│   ├── 🏷️ types/                  # 型定義層
│   │   └── index.ts               # TypeScript型定義
│   └── 🎨 styles/                 # スタイル層
│       ├── GlobalStyle.ts         # グローバルスタイル
│       ├── theme.ts               # テーマ設定
│       ├── index.css              # ベースCSS
│       └── styled.d.ts            # スタイル型定義
├── 📦 package.json                # 依存関係定義
├── ⚙️ vite.config.ts             # Vite設定
└── 🔧 tsconfig.json              # TypeScript設定
```

### フロントエンド階層アーキテクチャ

```
┌─────────────────────────────────┐
│ 🎯 Entry Point Layer            │ App.tsx, main.tsx
├─────────────────────────────────┤
│ 📱 Presentation Layer           │ Pages (10コンポーネント)
├─────────────────────────────────┤
│ 🧩 Component Layer              │ Layout, ProtectedRoute
├─────────────────────────────────┤
│ 🪝 Business Logic Layer         │ Hooks (useAuth)
├─────────────────────────────────┤
│ 🔧 Utility Layer                │ API, Permissions
├─────────────────────────────────┤
│ 🏷️ Type Definition Layer        │ TypeScript Types
├─────────────────────────────────┤
│ 🎨 Styling Layer                │ Styled Components, Theme
└─────────────────────────────────┘
```

## 🔧 バックエンドモジュール構成

### ディレクトリ構造

```
backend/
├── src/
│   ├── 🎯 index.ts                # アプリケーションエントリーポイント
│   ├── 🛣️ routes/                 # ルーティング層
│   │   ├── auth.ts                # 認証ルート
│   │   └── customers.ts           # 顧客ルート
│   ├── 🎮 controllers/            # コントローラー層
│   │   ├── AuthController.ts      # 認証コントローラー
│   │   └── CustomerController.ts  # 顧客コントローラー
│   ├── 🗄️ models/                 # データモデル層
│   │   ├── BaseModel.ts           # ベースモデル
│   │   ├── UserModel.ts           # ユーザーモデル
│   │   ├── CustomerModel.ts       # 顧客モデル
│   │   ├── ProductModel.ts        # 商品モデル
│   │   ├── OrderModel.ts          # 注文モデル
│   │   └── PermissionModel.ts     # 権限モデル
│   ├── 🛡️ middleware/             # ミドルウェア層
│   │   ├── auth.ts                # JWT認証ミドルウェア
│   │   └── permission.ts          # 権限チェックミドルウェア
│   ├── 💾 database/               # データベース層
│   │   ├── connection.ts          # DB接続管理
│   │   ├── schema.sql             # スキーマ定義
│   │   └── seed.ts                # サンプルデータ
│   ├── 🏷️ types/                  # 型定義層
│   │   └── index.ts               # API型定義
│   └── 🔧 utils/                  # ユーティリティ層
├── 📦 package.json                # 依存関係定義
└── 🔧 tsconfig.json              # TypeScript設定
```

### バックエンド階層アーキテクチャ

```
┌─────────────────────────────────┐
│ 🎯 Application Layer            │ index.ts (Express App)
├─────────────────────────────────┤
│ 🛣️ Routing Layer                │ auth.ts, customers.ts
├─────────────────────────────────┤
│ 🛡️ Middleware Layer             │ auth.ts, permission.ts
├─────────────────────────────────┤
│ 🎮 Controller Layer             │ AuthController, CustomerController
├─────────────────────────────────┤
│ 🗄️ Model Layer                  │ BaseModel, UserModel, etc.
├─────────────────────────────────┤
│ 💾 Database Layer               │ SQLite connection, schema
├─────────────────────────────────┤
│ 🏷️ Type Definition Layer        │ API Types, Interfaces
└─────────────────────────────────┘
```

## 📊 主要モジュール詳細

### 1. フロントエンド主要モジュール

#### 🎯 App.tsx（アプリケーションルート）
- **役割**: アプリケーション全体の設定とルーティング
- **機能**: 
  - テーマプロバイダー設定
  - ルーター設定
  - グローバルスタイル適用
- **依存関係**: React Router, Styled Components, Theme

#### 📱 Pages（ページコンポーネント群）
| ファイル名 | 役割 | 主要機能 |
|-----------|------|---------|
| `DashboardPage.tsx` | ダッシュボード | 統計表示、グラフ、クイックアクション |
| `CustomersPage.tsx` | 顧客管理 | 顧客一覧、検索、CRUD操作 |
| `ProductsPage.tsx` | 商品管理 | 商品一覧、在庫管理 |
| `OrdersPage.tsx` | 注文管理 | 注文一覧、ステータス管理 |
| `LoginPage.tsx` | ログイン | 認証フォーム |
| `PermissionMatrixPage.tsx` | 権限管理 | 権限マトリックス表示 |

#### 🧩 Components（共通コンポーネント）
| ファイル名 | 役割 | 再利用性 |
|-----------|------|---------|
| `Layout.tsx` | レイアウト | 全ページ共通 |
| `ProtectedRoute.tsx` | 認証保護 | 認証が必要な全ルート |

#### 🪝 Hooks（カスタムフック）
- **useAuth.tsx**: 認証状態管理、ログイン/ログアウト処理

#### 🔧 Utils（ユーティリティ）
- **api.ts**: HTTP通信の抽象化、エラーハンドリング
- **permissions.ts**: 権限チェックロジック

### 2. バックエンド主要モジュール

#### 🎯 index.ts（エントリーポイント）
- **役割**: Express アプリケーション設定と起動
- **機能**:
  - ミドルウェア設定
  - ルート登録
  - データベース初期化
  - エラーハンドリング

#### 🛣️ Routes（ルーティング層）
| ファイル名 | エンドポイント | 機能 |
|-----------|-------------|------|
| `auth.ts` | `/api/auth/*` | 認証関連API |
| `customers.ts` | `/api/customers/*` | 顧客管理API |

#### 🎮 Controllers（コントローラー層）
| ファイル名 | 役割 | 主要メソッド |
|-----------|------|------------|
| `AuthController.ts` | 認証業務ロジック | login, register, profile |
| `CustomerController.ts` | 顧客業務ロジック | getAll, getById, create, update, delete |

#### 🗄️ Models（データモデル層）
| ファイル名 | 役割 | 対応テーブル |
|-----------|------|------------|
| `BaseModel.ts` | 共通データアクセス | - |
| `UserModel.ts` | ユーザー管理 | users |
| `CustomerModel.ts` | 顧客管理 | customers |
| `ProductModel.ts` | 商品管理 | products |
| `OrderModel.ts` | 注文管理 | orders, order_items |
| `PermissionModel.ts` | 権限管理 | permission_matrix |

#### 🛡️ Middleware（ミドルウェア層）
- **auth.ts**: JWT認証、トークン検証
- **permission.ts**: 権限チェック、アクセス制御

## 🔄 モジュール間依存関係

### フロントエンド依存関係図

```
App.tsx
├── Pages/ (10個)
│   ├── → Components/ (Layout, ProtectedRoute)
│   ├── → Hooks/ (useAuth)
│   ├── → Utils/ (api, permissions)
│   └── → Types/ (TypeScript interfaces)
├── Styles/ (theme, GlobalStyle)
└── Router (React Router)
```

### バックエンド依存関係図

```
index.ts
├── Routes/
│   ├── → Controllers/
│   └── → Middleware/
├── Controllers/
│   ├── → Models/
│   └── → Types/
├── Models/
│   ├── → Database/
│   └── → BaseModel
├── Middleware/
│   ├── → Models/ (User, Permission)
│   └── → Utils/
└── Database/
    └── SQLite
```

## 📦 外部依存関係

### フロントエンド主要依存関係
| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| `react` | 18.2.0 | UIライブラリ |
| `react-router-dom` | 6.20.1 | ルーティング |
| `styled-components` | 6.1.1 | スタイリング |
| `axios` | 1.6.2 | HTTP通信 |
| `typescript` | 5.2.2 | 型システム |

### バックエンド主要依存関係
| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| `express` | 4.18.2 | Webフレームワーク |
| `sqlite3` | 5.1.6 | データベース |
| `jsonwebtoken` | 9.0.2 | JWT認証 |
| `bcryptjs` | 2.4.3 | パスワードハッシュ |
| `zod` | 3.22.4 | バリデーション |

## 🎯 設計パターン

### 1. MVC パターン（バックエンド）
- **Model**: データアクセスとビジネスロジック
- **View**: REST API レスポンス
- **Controller**: リクエスト処理とレスポンス制御

### 2. コンポーネントベース設計（フロントエンド）
- **単一責任**: 各コンポーネントは1つの機能に特化
- **再利用性**: 共通コンポーネントの最大活用
- **階層化**: Pages → Components → Hooks → Utils

### 3. レイヤードアーキテクチャ
- **明確な分離**: 各層の責任を明確に分離
- **依存関係**: 上位層が下位層に依存
- **疎結合**: インターフェースを通じた結合

## 🔧 設定・運用モジュール

### Docker設定
- **docker-compose.yml**: 本格運用環境
- **docker-compose.lite.yml**: 軽量開発環境
- **Dockerfile**: フロントエンド・バックエンド個別

### スクリプト
- **setup.sh**: 環境セットアップ
- **docker-setup.sh**: Docker環境構築

### 設定ファイル
- **tsconfig.json**: TypeScript設定
- **vite.config.ts**: Vite設定  
- **package.json**: 依存関係・スクリプト定義

## 📈 拡張性

### 水平拡張
- 新しいページコンポーネントの追加
- 新しいAPIエンドポイントの追加
- 新しいデータモデルの追加

### 垂直拡張
- ミドルウェア層の強化
- ユーティリティ層の拡張
- カスタムフック層の拡張

---

*最終更新: 2024年1月15日*  
*作成者: システムアナリスト*
